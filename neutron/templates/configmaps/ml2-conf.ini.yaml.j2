apiVersion: v1
kind: ConfigMap
data:
  ml2-conf.ini: |+
    [ml2]
    {% if ironic.enabled %}
    type_drivers = flat
    tenant_network_types = flat
    mechanism_drivers = openvswitch
    {% else %}
    # Changing type_drivers after bootstrap can lead to database inconsistencies
    type_drivers = flat,vlan,vxlan
    tenant_network_types = vxlan
    mechanism_drivers = openvswitch,l2population
    {% endif %}

    [ml2_type_flat]
    flat_networks = physnet1

    [ml2_type_vxlan]
    vni_ranges = 1:1000
    vxlan_group = 239.1.1.1

    [securitygroup]
    enable_security_group = True
    {% if ironic.enabled %}
    firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver
    {% else %}
    # TODO(DTadrzak): FIX ME
    firewall_driver = noop
    {% endif %}

    [agent]
    tunnel_types = vxlan
    # TODO(DTadrzak): FIX ME
    l2_population = false
    arp_responder = true

    [ovs]
    bridge_mappings = physnet1:{{ neutron.bridge_name }}
    local_ip = {{ network.ip_address }}

    [vxlan]
    # TODO(DTadrzak): FIX ME
    l2_population = false
    local_ip = {{ network.ip_address }}
