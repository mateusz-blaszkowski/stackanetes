apiVersion: v1
kind: ConfigMap
data:
  ironic.conf: |+
    [DEFAULT]
    debug = {{ misc.debug }}
    use_syslog = False
    use_stderr = True

    listen_address = {{ network.ip_address }}
    rpc_thread_pool_size = 512
    executor_thread_pool_size = 512
    enabled_drivers = pxe_ipmitool,agent_ipmitool_socat,agent_pyghmi,fake

    [api]
    api_workers=128

    [ironic]
    os_auth_url = {{ keystone.auth_url }}
    os_username = {{ keystone.ironic_user }}
    os_password = {{ keystone.ironic_password }}
    admin_user = {{ keystone.ironic_user }}
    admin_username = {{ keystone.ironic_user }}
    admin_password = {{ keystone.ironic_password }}
    os_tenant_name = service

    [firewall]
    manage_firewall = False
    # TODO:
    # dnsmasq_interface = {{ api_interface }}

    [processing]
    node_not_found_hook = enroll
    store_data = swift

    [pxe]
    ipxe_enabled=True
    pxe_bootfile_name=undionly.kpxe
    uefi_pxe_bootfile_name=ipxe.efi
    pxe_config_template=$pybasedir/drivers/modules/ipxe_config.template
    uefi_pxe_config_template=$pybasedir/drivers/modules/ipxe_config.template
    tftp_server = {{ network.ip_address }}
    tftp_master_path = /pxeboot/tftpboot
    tftp_root=/pxeboot/tftpboot
    pxe_append_params = ipa-debug=1 nofb nomodeset vga=normal console=ttyS0,115200n8

    [deploy]
    http_root=/pxeboot/httpboot

    {% if network.external_ips|length > 0 %}
    http_url=http://{{ network.external_ips[0] }}:{{ network.port.http }}
    {% else %}
    http_url=http://{{ network.ip_address }}:{{ network.port.http }}
    {% endif %}

    [conductor]
    api_url = http://{{ network.ip_address }}:{{ network.port.api }}
    clean_nodes = false
    automated_clean=false
    sync_power_state_interval = 7200
    #periodic_max_workers = 256
    #workers_pool_size = 512


    [database]
    connection = mysql+pymysql://{{ database.ironic_user }}:{{ database.ironic_password }}@{{ database.address }}/{{ database.ironic_database_name }}

    [keystone_authtoken]
    auth_url = {{ keystone.auth_url }}
    auth_uri = {{ keystone.auth_uri }}
    auth_type = password
    project_domain_id = default
    user_domain_id = default
    project_name = service
    username = {{ keystone.ironic_user }}
    password = {{ keystone.ironic_password }}

    [glance]
    glance_host = {{ glance.api_url }}

    swift_container = glance
    swift_api_version = v1
    swift_endpoint_url = {{ swift.endpoint_url }}
    swift_temp_url_key = {{ swift.temp_url_key }}
    temp_url_endpoint_type = radosgw

    [neutron]
    url = {{ neutron.api_url }}
    auth_strategy = keystone
    metadata_proxy_shared_secret = {{ neutron.metadata_secret }}
    service_metadata_proxy = true

    [oslo_messaging_rabbit]
    rabbit_userid = {{ rabbitmq.admin_user }}
    rabbit_password = {{ rabbitmq.admin_password }}
    rabbit_ha_queues = true
    rabbit_hosts = {{ rabbitmq.address }}
